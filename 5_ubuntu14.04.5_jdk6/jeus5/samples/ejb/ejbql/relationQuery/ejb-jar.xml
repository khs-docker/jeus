<?xml version="1.0"?>
<!DOCTYPE ejb-jar PUBLIC '-//Sun Microsystems, Inc.//DTD Enterprise JavaBeans 2.0//EN' 'http://java.sun.com/dtd/ejb-jar_2_0.dtd'>
<ejb-jar>
    <enterprise-beans>
        <entity>
            <ejb-name>CustomerBean</ejb-name>
            <local>ejb.ejbql.relationQuery.CustomerLocal</local>
            <local-home>ejb.ejbql.relationQuery.CustomerHomeLocal</local-home>
            <home>ejb.ejbql.relationQuery.CustomerHome</home>
            <remote>ejb.ejbql.relationQuery.Customer</remote>
            <ejb-class>ejb.ejbql.relationQuery.CustomerEJB</ejb-class>
            <persistence-type>Container</persistence-type>
            <cmp-version>2.x</cmp-version>
            <abstract-schema-name>Customer</abstract-schema-name>
            <prim-key-class>java.lang.Integer</prim-key-class>
            <reentrant>False</reentrant>
            <cmp-field>
                <field-name>id</field-name>
            </cmp-field>
            <cmp-field>
                <field-name>name</field-name>
            </cmp-field>
            <primkey-field>id</primkey-field>

            <query>
                <query-method>
                    <method-name>findAll</method-name>
                    <method-params/>
                </query-method>
                <ejb-ql>SELECT OBJECT(c) FROM Customer c</ejb-ql>
            </query>
			<query>
				<query-method>
					<method-name>ejbSelectNested1</method-name>
					<method-params/>
				</query-method>
				<ejb-ql>
					<![CDATA[
					SELECT c.name FROM Customer c where c.reservations IS NOT EMPTY
					]]>
				</ejb-ql>
			</query>
        </entity>
        <entity>
            <ejb-name>ReservationBean</ejb-name>
            <local>ejb.ejbql.relationQuery.ReservationLocal</local>
            <local-home>ejb.ejbql.relationQuery.ReservationHomeLocal</local-home>
            <home>ejb.ejbql.relationQuery.ReservationHome</home>
            <remote>ejb.ejbql.relationQuery.Reservation</remote>
            <ejb-class>ejb.ejbql.relationQuery.ReservationEJB</ejb-class>
            <persistence-type>Container</persistence-type>
            <cmp-version>2.x</cmp-version>
            <abstract-schema-name>Reservation</abstract-schema-name>
            <prim-key-class>java.lang.Integer</prim-key-class>
            <reentrant>False</reentrant>
            <cmp-field>
                <field-name>id</field-name>
            </cmp-field>
            <cmp-field>
                <field-name>payAmount</field-name>
            </cmp-field>
            <cmp-field>
                <field-name>reservedDate</field-name>
            </cmp-field>
            <primkey-field>id</primkey-field>

            <query>
                <query-method>
                    <method-name>findAll</method-name>
                    <method-params/>
                </query-method>
                <ejb-ql>SELECT OBJECT(r) FROM Reservation r</ejb-ql>
            </query>
			<query>
				<query-method>
					<method-name>ejbSelectNested1</method-name>
					<method-params/>
				</query-method>
				<ejb-ql>
					<![CDATA[
					SELECT c.name FROM Reservation r, IN (r.customers) c
					WHERE r.customers IS NOT EMPTY AND c.name LIKE '%_%'
					AND c.name IN (SELECT cc.name FROM Customer cc, IN (cc.reservations) rr WHERE cc MEMBER OF rr.customers )
					]]>
				</ejb-ql>
			</query>
        </entity>
    </enterprise-beans>
    <relationships>
        <ejb-relation>
            <ejb-relation-name>Customer-Reservation</ejb-relation-name>
            <ejb-relationship-role>
                <ejb-relationship-role-name>Customer-has-many-Reservations</ejb-relationship-role-name>
                <multiplicity>Many</multiplicity>
                <relationship-role-source>
                    <ejb-name>CustomerBean</ejb-name>
                </relationship-role-source>
                <cmr-field>
                    <cmr-field-name>reservations</cmr-field-name>
                    <cmr-field-type>java.util.Collection</cmr-field-type>
                </cmr-field>
            </ejb-relationship-role>
            <ejb-relationship-role>
                <ejb-relationship-role-name>Reservation-has-many-Customers</ejb-relationship-role-name>
                <multiplicity>Many</multiplicity>
                <relationship-role-source>
                    <ejb-name>ReservationBean</ejb-name>
                </relationship-role-source>
                <cmr-field>
                    <cmr-field-name>customers</cmr-field-name>
                    <cmr-field-type>java.util.Collection</cmr-field-type>
                </cmr-field>
            </ejb-relationship-role>
        </ejb-relation>
    </relationships>
    <assembly-descriptor>
        <container-transaction>
            <method>
                <ejb-name>CustomerBean</ejb-name>
                <method-name>*</method-name>
                <method-params/>
            </method>
            <trans-attribute>Required</trans-attribute>
        </container-transaction>
        <container-transaction>
            <method>
                <ejb-name>ReservationBean</ejb-name>
                <method-name>*</method-name>
                <method-params/>
            </method>
            <trans-attribute>Required</trans-attribute>
        </container-transaction>
    </assembly-descriptor>
</ejb-jar>
